<%
  unseen_episodes = Episodes::UnseenQuery.new(show).for_user(current_user)
%>
<div class="row align-items-center <% unless unseen_episodes.any? %>show-completed<% end %>">
  <div class="col col-lg-3 text-center">
    <% if show.image.present? %>
      <%= link_to show do %>
        <% image_tag banner_url(show.image), width: 150, alt: "Poster", loading: :lazy %>
      <% end %>
    <% end %>
  </div>
  <div class="col col-lg-9">
    <h3><%= link_to show.title, show %></h3>
    <p class="mr-lg-5 pr-lg-5"><%= show.overview %></p>
    <p>
      <%= link_to show do %>
        Seasons: <%= show.seasons.size %>
        &middot;
        Subscriptions: <%= show.subscriptions.size %>
        &middot;
        Episodes: <%= show.episodes.size %> - Seen: <%= current_user.episode_states.where(episode: show.episodes).where.not(seen_at: nil).size %>
      <% end %>
    </p>

    <% if current_user.subscriptions.where(show: show).none? %>
      <%= link_to "Subscribe", show_subscription_path(show), method: :post, class: "btn btn-primary" %>
    <% else %>
      <%= link_to "Unubscribe", show_subscription_path(show), method: :delete, class: "btn btn-danger", data: { confirm: "Are you sure?" } %>
    <% end %>

    <% if unseen_episodes.any? %>
      <%= link_to "Mark as seen", show_state_path(show, seen: true), method: :put, class: "btn btn-link" %>
    <% else %>
      <%= link_to "Mark as unseen", show_state_path(show, seen: false), method: :put, class: "btn btn-link" %>
    <% end %>
  </div>
</div>

<hr />
